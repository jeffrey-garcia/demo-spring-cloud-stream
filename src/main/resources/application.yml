# Local RabbitMQ binder config
spring:
  cloud:
    stream:
      rabbit:
        bindings:
          output:
            producer:
              # A SpEL expression to determine the routing key to use when publishing messages
              routing-key-expression: '"test.event.1"'
              # The routing key  to use when publishing messages
              bindingRoutingKey: test.event.1
              # make the channel transactional for each publish, guarantee a message isn't lost
              transacted: true
          input:
            consumer:
              # The routing key with which to bind the queue to the exchange
              bindingRoutingKey: test.event.1
              # consumer must manually acknowledge message
              acknowledge-mode: manual
              # The maximum number of consumers
              maxConcurrency: 3
      bindings:
        input:
          # Name of the Exchange
          destination: demo-exchange
          contentType: application/json
          binder: local_rabbit
          # Name of the Queue
          # each application instance will have a dedicated RabbitMQ Consumer instance for its groupâ€™s Queue
          group: demo-queue
          # Disable default binder retry
          # if not configured, default binder will assume 3 attempts before it considered the retries are exhausted
          # if set to 1, binder retry will be disabled and message are routed to DLQ right-away when any exception
          consumer:
            max-attempts: 1
            # The number of concurrent consumers to initially start for each listener
            # when ordering of message doesn't matter
            concurrency: 2
        output:
          # Name of the Exchange
          destination: demo-exchange
          contentType: application/json
          group: demo-queue
          binder: local_rabbit
      binders:
        local_rabbit:
          type: rabbit
          environment:
            spring:
              rabbitmq:
                # connect to RabbitMQ cluster and fail-over at the client-side regardless a HA-proxy
                addresses: localhost:5674,localhost:5672
#                host: localhost
#                port: 5672
                username: guest
                password: guest
                connection-timeout: 60000
                acknowledge-mode: manual
                # Requested heartbeat timeout, in seconds; zero for none.
                requested-heartbeat: 15000
